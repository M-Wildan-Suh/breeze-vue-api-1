import{_ as T}from"./PackingLayout-3c14fa63.js";import{a as z,r as i,a1 as J,C as k,x as M,c as $,d as y,e as R,w as l,i as U,f as d,J as A,h as a,s as G,n as H,t as _,m as b,F as K,p as O,q as W}from"./index-c1909b7c.js";import{_ as X}from"./LoadingAdmin-5d743fa9.js";import{Q as Y}from"./QrChecker-9a5ff8ea.js";import{_ as Z}from"./SuccessMessage-50cc8be4.js";import{u as I}from"./stock-cea63cd5.js";import"./vue-qrcode-reader-8adc1da8.js";const tt={class:"relative"},et={class:"bg-light-primary-1 dark:bg-dark-primary-2 p-5 rounded-lg space-y-3 shadow-lg"},st={class:"flex justify-between"},at=a("i",{class:"fa-solid fa-camera dark:text-typography-1"},null,-1),ot=[at],nt=["disabled"],rt=a("i",{class:"fa-solid fa-check"},null,-1),ct=a("p",null,"Save",-1),it=[rt,ct],lt={class:"py-2"},dt={class:"line-clamp-2"},ut={key:0},pt={class:"flex justify-center gap-1"},yt=a("p",null,"/",-1),qt={__name:"Scan",setup(_t){const m=z().params.invoice,f=i(),g=J(),B=I(),w=i(!1),q=i(!0),h=i([]),D=k(()=>h.value),P=i([]),Q=k(()=>P.value),x=k(()=>r.value.some(s=>s.scanned<s.quantity)),v=i({paused:!1,alert:!1}),S=i({products:[]}),r=i([]),E=async s=>{await g.checkQrPacking(s,h,w,m,v,P,r),await L(500)},L=async s=>new Promise(n=>{window.setTimeout(n,s)});M(async()=>{await g.paymentByInvoiceCode(m,q),j()});const j=()=>{f.value=g.singlePayment,F()},F=()=>{var n;const s=((n=f.value)==null?void 0:n.items.filter(e=>e.product_id!==null))||[];console.log(s),s.forEach(e=>{var p;if((p=e.bundling)!=null&&p.item)e.bundling.item.forEach(t=>{const o=r.value.find(c=>{var u,C;return((u=c==null?void 0:c.product)==null?void 0:u.id)===((C=t==null?void 0:t.product)==null?void 0:C.id)});o?o.quantity+=e.quantity:r.value.push({product:t.product,quantity:e.quantity,scanned:0,code:[]})});else{const t=r.value.find(o=>{var c,u;return((c=o==null?void 0:o.product)==null?void 0:c.id)===((u=e==null?void 0:e.product)==null?void 0:u.id)});t?t.quantity+=e.quantity:r.value.push({product:e.product,quantity:e.quantity,scanned:0,code:[]})}})},N=[{key:"product.product_name",title:"Product"},{key:"code",title:"Product Code"},{key:"quantity",title:"Quantity",align:"center"}],V=async()=>{const s=new FormData;r.value.forEach((n,e)=>{s.append(`products[${e}][code]`,n.code),s.append(`products[${e}][id]`,n.product.id),s.append(`products[${e}][quantity]`,n.quantity)}),s.append("payment_id",f.value.id),await B.submitToPacked(s,h,w)};return(s,n)=>{const e=$("v-dialog"),p=$("v-data-table");return y(),R(T,{title:"Packing for "+U(m)},{default:l(()=>[d(A,{class:"w-full",errors:D.value},null,8,["errors"]),d(Z,{class:"w-full",messages:Q.value},null,8,["messages"]),a("div",tt,[d(X,{isLoading:q.value},null,8,["isLoading"]),a("div",et,[a("div",st,[d(e,null,{activator:l(({props:t})=>[a("button",G({type:"button"},t,{onClick:n[0]||(n[0]=o=>v.value.paused=!1)}),ot,16)]),default:l(({isActive:t})=>[a("div",null,[a("div",null,[d(Y,{qr:v.value,checkQr:E,result:S.value.products,"onUpdate:result":n[1]||(n[1]=o=>S.value.products=o),show:t},null,8,["qr","result","show"])])])]),_:1}),a("button",{type:"button",disabled:x.value,onClick:V,class:H([x.value?"bg-gray-500":"bg-secondary-3 hover:bg-opacity-90","!text-light-primary-1 px-3 py-2 rounded-lg text-sm cursor-pointer flex justify-center items-center gap-3"])},it,10,nt)]),d(p,{search:s.searchData,headers:N,items:r.value,"hide-default-footer":"","header-props":{class:"dark:bg-dark-primary-1 bg-light-primary-2 dark:!text-white border-b dark:!border-white/30"},"item-key":"id",class:"border dark:!border-typography-2/20 shadow-lg dark:!bg-dark-primary-1 !bg-light-primary-2 dark:!text-typography-1"},{"item.product.product_name":l(({item:t})=>{var o;return[a("div",lt,[a("p",dt,_((o=t==null?void 0:t.product)==null?void 0:o.product_name),1)])]}),"item.code":l(({item:t})=>[t.code.length>0?(y(),b("ul",ut,[(y(!0),b(K,null,O(t.code,(o,c)=>(y(),b("li",{key:c,class:"list-disc"},_(o),1))),128))])):W("",!0)]),"item.quantity":l(({item:t})=>[a("div",pt,[a("p",null,_(t.scanned),1),yt,a("p",null,_(t.quantity),1)])]),_:1},8,["search","items"])])])]),_:1},8,["title"])}}};export{qt as default};
